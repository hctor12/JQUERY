<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <style></style>
  </head>
  <body>
    <h1>Maestro detalle empleados departamentos</h1>
    <ul id="listaDeps"></ul>
    <table id="tablaInfo" border="1">
      <thead>
        <tr>
          <th>Apellido</th>
          <th>Oficio</th>
          <th>Salario</th>
          <th>Departamento</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
    <script src="js/jquery-3.7.1.min.js"></script>
    <script>
      const urlD = "https://apicruddepartamentospgs.azurewebsites.net/";
      const urlC = "https://apiempleadosspgs.azurewebsites.net/";

      function getDeps() {
        const request = "webresources/departamentos";
        $.getJSON(urlD + request, function (data) {
          $.each(data, function (index, object) {
            let nombre = object.nombre;
            let id = object.numero;
            let loc = object.localidad;
            let linkDetalle = $(
              `<a id="${id}" data-loc="${loc}" href="">Empleados</a>`
            );
            linkDetalle.click(function (event) {
              event.preventDefault();
              console.log($(this).data("loc"));
              $("#tablaInfo tbody").empty();
              console.log(id);
              const request = "api/Empleados";
              $.getJSON(urlC + request, function (data) {
                $.each(data, function (index, object) {
                  let depC = object.departamento;
                  let apellido = object.apellido;
                  let oficio = object.oficio;
                  let salario = object.salario;

                  if (id === depC) {
                    $("#tablaInfo tbody").append("<tr>");
                    $("#tablaInfo tbody").append(`<td>${apellido}</td>`);
                    $("#tablaInfo tbody").append(`<td>${oficio}</td>`);
                    $("#tablaInfo tbody").append(`<td>${salario}</td>`);
                    $("#tablaInfo tbody").append(`<td>${depC}</td>`);
                    $("#tablaInfo tbody").append("</tr>");
                  }
                });
              });
            });
            let dep = $("#listaDeps").append(
              $(`<li>${nombre}</li>`).append(linkDetalle)
            );
          });
        });
      }
      $(document).ready(function () {
        getDeps();
      });
    </script>
  </body>
</html>
