<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <link rel="stylesheet" href="css/bootstrap.min.css" />
  </head>
  <body>
    <div class="container">
      <nav class="navbar navbar-expand-lg bg-body-tertiary">
        <div class="container-fluid">
          <a class="navbar-brand" href="web29homedoctores.html">Práctica Final</a>
          <button
            class="navbar-toggler"
            type="button"
            data-bs-toggle="collapse"
            data-bs-target="#navbarNav"
            aria-controls="navbarNav"
            aria-expanded="false"
            aria-label="Toggle navigation"
          >
            <span class="navbar-toggler-icon"></span>
          </button>
          <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav">
              <li class="nav-item active">
                <a class="nav-link" aria-current="page" href="web29homedoctores.html"
                  >Home</a
                >
              </li>
              <li class="nav-item">
                <a class="nav-link" href="web29createdoctor.html">New Doctor</a>
              </li>
              </li>
            </ul>
          </div>
        </div>
      </nav>
      <div class="card">
        <h5 class="card-header">Doctores</h5>
        <div class="table-responsive text-nowrap">
          <table class="table" id="tabla">
            <thead>
              <tr>
                <th>ID Doctor</th>
                <th>ID Hospital</th>
                <th>Apellido</th>
                <th>Especialidad</th>
                <th>Salario</th>
                <th></th>
                <th></th>
              </tr>
            </thead>
            <tbody class="table-border-bottom-0"></tbody>
          </table>
        </div>
      </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="js/bootstrap.bundle.min.js"></script>
    <script src="js/jquery-3.7.1.min.js"></script>
    <script>
      const url = "https://apicruddoctores.azurewebsites.net/";

      function getDoctores() {
        let request = "api/Doctores";
        var html = "";

        $.ajax({
          url: url + request,
          method: "GET",
          dataType: "json",
          success: function (data) {
            $.each(data, function (index, object) {
              html += "<tr>";
              html += `<td>${object.idDoctor}</td>`;
              html += `<td>${object.idHospital}</td>`;
              html += `<td>${object.apellido}</td>`;
              html += `<td>${object.especialidad}</td>`;
              html += `<td>${object.salario}</td>`;
              html += `<td><a href="web29editdoctor.html?idDoctor=${object.idDoctor}"><button class="btn btn-secondary editBtn">Modificar</button></a></td>`;
              html += `<td><button value="${object.idDoctor}" class="btn btn-danger deleteBtn">Eliminar</button></td>`;
              html += "</tr>";
              $("#tabla tbody").html(html);
            });
          },
        });
      }

      $(document).ready(function () {
        getDoctores();

        $("#tabla").on("click", "button .deleteBtn", function(){
          const swalWithBootstrapButtons = Swal.mixin({
  customClass: {
    confirmButton: "btn btn-success btnConfirm ms-2",
    cancelButton: "btn btn-danger"
  },
  buttonsStyling: false
});
swalWithBootstrapButtons.fire({
  title: "Está seguro?",
  text: "No podrá revertir esto!",
  icon: "warning",
  showCancelButton: true,
  confirmButtonText: "Sí, eliminarlo!",
  cancelButtonText: "No, cancelar!",
  reverseButtons: true
}).then((result) => {
  if (result.isConfirmed) {
    swalWithBootstrapButtons.fire({
      title: "¡Eliminado!",
      text: "El doctor ha sido eliminado.",
      icon: "success"
    });
  } else if (
    /* Read more about handling dismissals below */
    result.dismiss === Swal.DismissReason.cancel
  ) {
    swalWithBootstrapButtons.fire({
      title: "Cancelado",
      icon: "error"
    });
  }
});
          let id = parseInt($(this).val());
          let request = `api/Doctores/${id}`;

          $(".btnConfirm").on("click", function(){
            $.ajax({
            url: url + request,
            method: "DELETE",
            success: function(){
              getDoctores();
            }
          })
          })
        })
      });
    </script>
  </body>
</html>
